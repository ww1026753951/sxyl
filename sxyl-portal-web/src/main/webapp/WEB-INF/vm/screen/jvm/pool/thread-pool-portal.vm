<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="算法 思想摇篮 动画算法 算法动画">
    <meta name="author" content="谷禾水">
    <link rel="icon" href="/favicon.ico">
    <title>算法,动画算法,算法动画,jvm,java虚拟机,线程池</title>
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="/css/bootstrap/bootstrap.min.css" >
##    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootstrap/dashboard.css" >
    <link rel="stylesheet" href="/css/bootstrap/bootstrap-reboot.min.css" >
    <script src="/js/d3/d3.min.js"></script>
    <script src="/js/jquery/jquery-3.2.1.min.js" ></script>
    <script src="/js/sxyl.js?a=8"></script>


    <script src="/js/sxyl.graph.js?a=3"></script>
    <script src="/js/sort/sort-common.js"></script>
    <script src="/js/animation/animation.base.js?a=7"></script>

    <script src="/js/math/MathJax.js?config=TeX-MML-AM_SVG"></script>
##    <script src="/js/math/latest.js?config=TeX-MML-AM_SVG1" ></script>


    <script src="/js/vendor/popper.min.js" ></script>
    <!-- Bootstrap JS -->
    <script src="/js/bootstrap/bootstrap.min.js" ></script>

    <script src="/js/bootstrap/jquery-bootstrap-modal-steps.js" ></script>


    <script src="/js/bg.js" ></script>

##    <script src="/js/bootstrap/bootstrap-input-spinner.js"></script>


    <style>
        body{
            font-size: 90%;
        }
        text{
            font-size: 95%;
        }
        tspan{
            font-size: 80%;
        }

        .sidebar-sticky a:hover{
            background: #C0C0C0;
        }
        .modal {
            top: -50px;
            left: -600px;
        }
        sub, sup {
            font-size: 30%;
            line-height: 0;
            position: relative;
            vertical-align: baseline;
        }
        sub {  bottom: -0.5em; }
        sup {
            left: -0.5em;
            /*top: 0.5em;*/
        }



    </style>
</head>

<body>

<div class="container-fluid">
    <div class="row">
        <main role="main" class="col-md-12" style="padding-top:10px">
            <div class="chartjs-size-monitor" style="position: absolute; left: 0px; top: 0px; right: 0px; bottom: 0px; overflow: hidden; pointer-events: none; visibility: hidden; z-index: -1;">
                <div class="chartjs-size-monitor-expand" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;">
                    <div style="position:absolute;width:1000000px;height:1000000px;left:0;top:0"></div>
                </div>
                <div class="chartjs-size-monitor-shrink" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;">
                    <div style="position:absolute;width:200%;height:200%;left:0; top:0"></div>
                </div>
            </div>

        ##            <div id ="arrayHtml"></div>
        ##操作面板的vm模块
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-0 pb-2 mb-1 border-bottom">


                <div class="btn-toolbar mb-3 mb-md-0  col-md-3">



                    <div class="btn-group mr-2">

                        <button id="insertButton" type="button" class="btn btn-sm btn-outline-secondary"  data-toggle="modal" >
                            <span id="insertTreeNode">新增任务</span>
                        </button>

                        &nbsp;&nbsp;
                        <button id="delButton" type="button" class="btn btn-sm btn-outline-secondary"  data-toggle="modal" data-target="#delModal" disabled>
                            <span id="delTreeNode">任务执行</span>
                        </button>


                        &nbsp;&nbsp;
                        <button id="configButton" type="button" class="btn btn-sm btn-outline-secondary"  data-toggle="modal" data-target="#configModal" >
                            <span id="configButton">参数设置</span>
                        </button>

                        &nbsp;&nbsp;
##                        <button id="run" class="btn btn-sm  btn-outline-secondary " disabled>
##                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 8 8">
##                                <path id="play-next" d="M0 0v6l6-3-6-3z" transform="translate(1 1)" />
##                            </svg>
##                            <span id="run-next" run-type="0">播放</span>
##                        </button>
                        &nbsp;&nbsp;
                        <button class="btn btn-sm btn-outline-secondary" id="run" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 8 8">
                                <path id="play-path" d="M0 0v6l6-3-6-3z" transform="translate(1 1)" />
                            </svg>
                            <span id="run-pause" run-type="0">播放</span>
                        </button>
                    </div>
                </div>

            </div>




            <div id="algorithm-content" class="row">
                <div id="graph-content" class="col-lg-9 col-sm-9 ">
                    <svg id="sortAlg" width="1200" height="600">
                    </svg>
                </div>
                <div class="col-lg-3 col-sm-3">
                    <div>

                    </div>
                    <div id="step-content">
                    </div>

                </div>
            </div>


        ##
            <footer class="py-0 bg-white">
                <div class="container">
                    <p class="m-0 text-center text-black-50">Copyright &copy; 2018-2020 $!{dc.domain} $!{dc.domainName} by <a href="mailto:ww1026753951@163.com">谷禾水</a> .All rights reserved</p>
                    <p class="m-0 text-center text-black-50">版权声明：本站原创文章、作品，未经本人许可，任何人或机构不得以任何形式对本站内容进行复制作商业用途.</p>
                </div>
            </footer>

        </main>
    </div>
</div>
##
##<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
##    <div class="modal-dialog modal-dialog-centered">
##        <div class="modal-content" style="width: 800px">
##            <div class="modal-header">
##
##            </div>
##            <div class="modal-body"style="width: 800px;height: 300px">
##
##                <div class="form-group">
##                    <label>自定义数组</label>
##                    <input type="text" id ="arrayStr" class="form-control" placeholder="自定义数组,逗号分隔">
##                </div>
##                <br><br>
##
##
##            </div>
##            <div class="modal-footer">
##                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
##                <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="changeBySelf(false)">提交更改</button>
##            </div>
##        </div>
##    </div>
##</div>


##
<div class="modal fade" id="delModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="width: 800px">
            <div class="modal-header">

            </div>
            <div class="modal-body"style="width: 800px;height: 300px">

                <div class="form-group">
                    <label>输入任务编号执行任务。执行后任务将被执行完毕，任务所占用的线程将处于空闲。其中核心线程不会自动销毁，非核心线程池中的线程将会根据 keepAliveTime 的设置自动销毁</label>

                    <input type="text" id ="delNodeValue" class="form-control" placeholder="请输入任务编号,例如：1">
                    <label style="color: red">注:核心线程中的线程默认为不可自动销毁，但是可通过参数设置为自动销毁，参数为 allowCoreThreadTimeOut。 </label>
                </div>
                <br><br>


            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="del()">任务执行</button>
            </div>
        </div>
    </div>
</div>



<div class="modal fade" id="configModal" tabindex="-1" role="dialog" aria-labelledby="configModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="width: 800px">
            <div class="modal-header">

            </div>
            <div class="modal-body"style="width: 800px;height: 300px">

                <div class="form-group">
                    <label>核心线程池数量:</label>
                    <input type="text" id ="corePoolSize" class="form-control" placeholder="核心线程池数量:1-3,默认2">

                    <label>最大线程池数量:</label>
                    <input type="text" id ="maxPoolSize" class="form-control" placeholder="最大线程池数量:1-6,默认6">

                    <p class="m-2"><b>队列数量:</b></p>
                    <input type="text" id ="queueSize" class="form-control" placeholder="队列数量:1-6,默认6" >
                </div>
                <div class="btn-group mr-2">
                    <p class="m-2"><b>拒绝策略:</b></p>
                    <label class="radio-inline m-2" >
                        <input type="radio" name="speedRadioOptions" id="abortPolicy" value="1" checked="checked" > AbortPolicy
                    </label>
                    <label class="radio-inline m-2" >
                        <input type="radio" name="speedRadioOptions" id="discardPolicy" value="2" > DiscardPolicy
                    </label>
                    <label class="radio-inline m-2" >
                        <input type="radio" name="speedRadioOptions" id="discardOldestPolicy" value="3"> DiscardOldestPolicy
                    </label>
                    <label class="radio-inline  m-2">
                        <input type="radio" name="speedRadioOptions" id="callerRunsPolicy" value="4"> CallerRunsPolicy
                    </label>
                </div>


                <br><br>


            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="config()">初始化线程池</button>
            </div>
        </div>
    </div>
</div>

##
##
##<div class="modal fade" id="insertModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
##    <div class="modal-dialog modal-dialog-centered">
##        <div class="modal-content" style="width: 800px">
##            <div class="modal-header">
##            </div>
##            <div class="modal-body"style="width: 800px;height: 300px">
##
##                <div class="form-group">
##                    <label>数字</label>
##                    <input type="text" id ="nodeValue" class="form-control" placeholder="新增节点">
##                </div>
##                <br><br>
##            </div>
##            <div class="modal-footer">
##                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
##                <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="insert()">新增节点</button>
##            </div>
##        </div>
##    </div>
##</div>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
##<script src="/js/vendor/jquery-slim.min.js" ></script>
<!-- Popper.JS -->


<script>
    var rbArray = {} ;
    //播放的事件
    $('#run').bind('click', function () {
        SXYL.SORT.run(SXYL.ANIMATION.executeAnimation, SXYL.SORT.getSpeed(SXYL.SORT.getSpeed()));
    });
    //重置的事件
    $('#reset').bind('click', function () {
        changeBySelf(true);
    });

    //速度变化的事件
    $('input[type=radio][name=speedRadioOptions]').change(function() {
        SXYL.SORT.changeSpeed(SXYL.ANIMATION.executeAnimation, SXYL.SORT.getSpeed());
    });


    $('#insertButton').bind('click', function () {
        insert();
    });


    $('#run').bind('click',function () {

        //执行第一步骤
        var resultEnd = SXYL.ANIMATION.executeAnimation() ;
        if(resultEnd){
            $("#step-content").html("动画步骤结束!");
            $("#run").attr("disabled","disable");
            $("#run-next").html("播放");
            enableButton();

        }else{
            $("#run").removeAttr("disabled");
            $("#run-next").html("请点我");
        }
    })


    $('#mode-type').bind('change' , function (a,b,c,d,e) {

        var modelVal = parseInt($('#mode-type').val());
        var showText=''
        if(modelVal == 1){
            showText='新增';
        }else if(modelVal == 2){
            showText='删除';
        }else if(modelVal == 3){
            showText='查询';
        }

        $('#insertOrDel').html(showText);


    })



    $('#myModal').modalSteps();
    loadData(true);

    function changeBySelf(random) {
        //清楚元素
        d3.select("#sortAlg").selectAll("g").remove();
        //按钮变为初始化
        SXYL.SORT.changeToStart();
        SXYL.GRAPH.initPosition();
        SXYL.step_no = 0;
        loadData();

    }
    function loadData() {
//        var minHeap = false;


        var arrayStr = $("#arrayStr").val();


//        /***
//         * 最大线程数 4
//         */
//        private int corePoolSize = 2;
//
//        /***
//         * 队列数量 6
//         */
//        private int queueSize = 6;
//
//        /****
//         * 最大线程数量 8
//         */
//        private int maxPoolSize = 6 ;


        if(!rbArray["data"]){
            rbArray["data"]={};
        }
        if($("#corePoolSize").val()){
            rbArray["data"]["corePoolSize"]=$("#corePoolSize").val();
        }
        if($("#queueSize").val()) {
            rbArray["data"]["queueSize"]=$("#queueSize").val();
        }

        if($("#maxPoolSize").val()){
            rbArray["data"]["maxPoolSize"]=$("#maxPoolSize").val();
        }



        rbArray["data"]["newConfig"]=true;


        var a = $("input[name='speedRadioOptions']:checked").val();

        rbArray["data"]["policyType"]=a;


        $.ajax({
            type: 'POST',
            url: "/jvm/threadPool/threadPoolConstruct",
            contentType:"application/json",
            data : JSON.stringify({
                pcd:rbArray["data"],
                executeHistory:{}
            }),
            success: function (d) {
                var parent = SXYL.GRAPH.getContext();
                //初始化dom结构
                SXYL.GRAPH.drawByComponent(parent , d.group);
//                SXYL.ANIMATION.ALL_STEP = d.at;

                rbArray["data"] = d.pcd;
                SXYL.GRAPH.initPosition();

            }
        });
    }

    function insert() {
//        var v = $("#nodeValue").val();
//        if(!v){
//            v = randomVal(0,100);
//            alert(v);
//        }

        //线程的特殊处理，当新增时,需要将当前线程的颜色传回到后台
        var threadArray = rbArray["data"]["threadMap"];
        for(var i=0; i<threadArray.length; i++) {
            var threadObj = $("#"+ threadArray[i][0]);
            if(threadObj.css("display") =='none'){
                rbArray["data"]["threadMap"][i][2]=true;
            }
            rbArray["data"]["threadMap"][i][1]=threadObj.css("fill");
        }


        disableButton();
        $.ajax({
            type: 'POST',
            contentType:"application/json",
            url: "/jvm/threadPool/addNewThread",
            data : JSON.stringify({
                pcd:rbArray["data"],
                executeHistory:rbArray["es"]
            }),
            success: function (d) {
                var parent = SXYL.GRAPH.getContext();
                SXYL.GRAPH.drawByComponent(parent , d.group);
                rbArray["data"] = d.pcd;
                rbArray["es"] = d.executeSteps;
                SXYL.step_no = 0 ;


                SXYL.ANIMATION.ALL_STEP = d.at;

                SXYL.after_fun = enableButton;

//                SXYL.SORT.start(SXYL.ANIMATION.executeAnimation,  SXYL.SORT.getSpeed());
                SXYL.SORT.start(SXYL.ANIMATION.executeAnimation,  600);


//                enableButton();

                //执行第一步骤
//                SXYL.ANIMATION.executeAnimation() ;
//                $("#run").removeAttr("disabled");
//                $("#run-next").html("请点我");
            }
        });

        function randomVal(min, max) {
            return Math.floor(Math.random() * (max - min)) + min
        }
    }

    function config() {

        debugger
        //清楚元素
        d3.select("#sortAlg").selectAll("*").remove();
//        d3.select("#sortAlg").selectAll("").remove();
        //按钮变为初始化
        SXYL.SORT.changeToStart();
        SXYL.GRAPH.initPosition();
        SXYL.step_no = 0;

        loadData();


//        SXYL.SORT.changeToStart();




//        var threadArray = rbArray["data"]["threadMap"];
//        for(var i=0; i<threadArray.length; i++) {
//            var threadObj = $("#"+ threadArray[i][0]);
//            if(threadObj.css("display") =='none'){
//                rbArray["data"]["threadMap"][i][2]=true;
//            }
//            rbArray["data"]["threadMap"][i][1]=threadObj.css("fill");
//        }



//        $.ajax({
//            type: 'POST',
//            contentType:"application/json",
//            url: "/jvm/threadPool/executeTask?taskNo="+parseInt(v,10),
//            data : JSON.stringify({
//                pcd:rbArray["data"]//,
////                taskNo:parseInt(v,10)
//            }),
//            success: function (d) {
//                if(d.errorMsg){
//                    alert(d.errorMsg);
//                    return;
//                }
//
//
//
//
//                var parent = SXYL.GRAPH.getContext();
////                SXYL.GRAPH.drawByComponent(parent , d.group);
//                rbArray["data"] = d.pcd;
//                rbArray["es"] = d.executeSteps;
//                SXYL.step_no = 0 ;
//
//
//                SXYL.ANIMATION.ALL_STEP = d.at;
//
//                SXYL.after_fun = enableButton;
//
////                SXYL.SORT.start(SXYL.ANIMATION.executeAnimation,  SXYL.SORT.getSpeed());
//                SXYL.SORT.start(SXYL.ANIMATION.executeAnimation,  600);
//
//
//            }
//        });

    }


    function del() {

        var v = $("#delNodeValue").val();


        SXYL.SORT.changeToStart();

        if(!v){
            alert('请输入任务编号进行任务执行!');
            return;
        }

        debugger;


        var threadArray = rbArray["data"]["threadMap"];
        for(var i=0; i<threadArray.length; i++) {
            var threadObj = $("#"+ threadArray[i][0]);
            if(threadObj.css("display") =='none'){
                rbArray["data"]["threadMap"][i][2]=true;
            }
            rbArray["data"]["threadMap"][i][1]=threadObj.css("fill");
        }


//        disableButton();

        $.ajax({
            type: 'POST',
            contentType:"application/json",
            url: "/jvm/threadPool/executeTask?taskNo="+parseInt(v,10),
            data : JSON.stringify({
                pcd:rbArray["data"]//,
//                taskNo:parseInt(v,10)
            }),
            success: function (d) {
                if(d.errorMsg){
                    alert(d.errorMsg);
                    return;
                }




                var parent = SXYL.GRAPH.getContext();
//                SXYL.GRAPH.drawByComponent(parent , d.group);
                rbArray["data"] = d.pcd;
                rbArray["es"] = d.executeSteps;
                SXYL.step_no = 0 ;


                SXYL.ANIMATION.ALL_STEP = d.at;

                SXYL.after_fun = enableButton;

//                SXYL.SORT.start(SXYL.ANIMATION.executeAnimation,  SXYL.SORT.getSpeed());
                SXYL.SORT.start(SXYL.ANIMATION.executeAnimation,  600);


            }
        });

    }


    watermark({watermark_txt0:'动画算法',watermark_txt1:"谷禾水",watermark_txt2:" "});


    //        alert($(window).width());
    //        alert();
    var contentHeight = ($(window).height()) - 150;
    $("#sortAlg").attr("height",contentHeight)



    function disableButton() {
        $("#insertButton").attr("disabled","disable");
        $("#delButton").attr("disabled","disable");
//        $("#run").addClass("btn-link");
        $("#run").removeAttr("disabled");
    }

    function enableButton() {
        $("#insertButton").removeAttr("disabled");
        $("#delButton").removeAttr("disabled");
        $("#run").attr("disabled","disable");
    }

</script>
</body>

</html>